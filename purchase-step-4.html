<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase - Summary - InsureMart</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #FF5B61;
      --secondary-color: #F59E0B;
      --accent-color: #FF4A50;
      --text-primary: #1E293B;
      --text-secondary: #86868B;
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8FAFC;
      --border-color: #E5E5EA;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #FFF5F5 0%, #FFEBEB 100%);
      color: var(--text-primary);
    }

    .app {
      max-width: 428px;
      margin: 0 auto;
      background: linear-gradient(180deg, #FFF5F5 0%, #FFEBEB 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 30px rgba(255, 91, 97, 0.15);
    }

    /* Header */
    .page-header {
      background: linear-gradient(135deg, #FF5B61 0%, #FF4A50 50%, #FF3940 100%);
      padding: 1rem 1.25rem;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title {
      flex: 1;
      text-align: center;
    }

    .header-title h1 {
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      margin: 0;
    }

    /* Progress Bar */
    .progress-section {
      background: white;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-color);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--bg-secondary);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      width: 100%;
      transition: width 0.3s ease;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 1.5rem 1.25rem;
      padding-bottom: 100px;
      overflow-y: auto;
    }

    .form-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }

    .customer-summary-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .form-instruction {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }

    .summary-section {
      margin-bottom: 1.5rem;
    }

    .summary-section-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 1rem;
      margin-top: 1.5rem;
    }

    .summary-section-title:first-child {
      margin-top: 0;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0.875rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .summary-item:last-child {
      border-bottom: none;
    }

    .summary-label-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .summary-label {
      font-size: 0.875rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .summary-label-small {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .summary-value-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.25rem;
    }

    .summary-value {
      font-size: 0.875rem;
      color: var(--text-primary);
      font-weight: 500;
      text-align: right;
    }

    .summary-value-large {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .summary-value-small {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .tax-note {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .tax-note-text {
      font-size: 0.8125rem;
      color: var(--text-primary);
      line-height: 1.6;
      text-align: left;
    }

    .success-banner {
      background: #E8F5E9;
      border-radius: 8px;
      padding: 0.875rem 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .success-banner i {
      color: #4CAF50;
      flex-shrink: 0;
    }

    .success-banner-text {
      font-size: 0.875rem;
      color: #2E7D32;
      font-weight: 500;
    }

    /* Navigation Buttons */
    .form-navigation {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 428px;
      background: white;
      border-top: 1px solid var(--border-color);
      padding: 1rem 1.25rem;
      display: flex;
      gap: 0.75rem;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      z-index: 100;
    }

    .nav-btn {
      flex: 1;
      padding: 0.875rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .nav-btn-secondary {
      background: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }

    .nav-btn-secondary:hover {
      background: rgba(234, 88, 12, 0.1);
    }

    .nav-btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .nav-btn-primary:hover {
      background: #FF4A50;
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
  </head>
  <body>
    <div class="app">
      <!-- Header -->
      <header class="page-header">
        <div class="header-top">
          <div class="header-title">
            <h1>Summary : Step 3 of 3</h1>
          </div>
          <div style="width: 40px;"></div>
        </div>
      </header>

      <!-- Progress Bar -->
      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>

      <!-- Main Content -->
      <main class="main-content">
        <div class="form-card">
          <h2 class="customer-summary-title">Summary</h2>
          <p class="form-instruction">
            Please review your policy details before final submission.
          </p>

          <div class="success-banner">
            <i data-lucide="check-circle"
              style="width: 20px; height: 20px;"></i>
            <span class="success-banner-text">Completed and verified</span>
          </div>

          <div class="summary-section">
            <div class="summary-section-title">Insurance Plan</div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Insurance Plan</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="insurance-plan">-</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Company Name</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="company-name">-</span>
              </div>
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-section-title">Period of Insurance</div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Start Date</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="start-date">-</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">End Date</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="end-date">-</span>
              </div>
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-section-title">Premium Breakdown</div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Gross Premium</span>
                <span class="summary-label-small">Premium Kasar</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="gross-premium">-</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Service Tax on Premium
                  (0.00%)</span>
                <span class="summary-label-small">Cukai Perkhidmatan atas
                  Premium</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="service-tax">-</span>
              </div>
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-section-title">Summary</div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Total Premium</span>
                <span class="summary-label-small">Jumlah Premium</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value-large" id="total-premium">-</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Intermediary Commission
                  (15.00%)</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="commission">-</span>
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label-group">
                <span class="summary-label">Stamp Duty</span>
                <span class="summary-label-small"
                  style="font-style: italic;">Duti Setem</span>
              </div>
              <div class="summary-value-group">
                <span class="summary-value" id="stamp-duty">RM 10.00</span>
              </div>
            </div>
          </div>

          <div class="tax-note">
            <p class="tax-note-text">
              Please be informed that you are obligated to pay any applicable
              taxes (including but not limited to service tax and stamp duty)
              imposed by the Malaysian tax authorities in relation to your
              policy.
            </p>
          </div>
        </div>
      </main>

      <!-- Navigation Buttons -->
      <div class="form-navigation">
        <button class="nav-btn nav-btn-secondary"
          onclick="window.location.href='purchase-step-2.html'">
          <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
          Back
        </button>
        <button class="nav-btn nav-btn-primary" onclick="submitApplication()">
          Submit Application
          <i data-lucide="check" style="width: 18px; height: 18px;"></i>
        </button>
      </div>
    </div>

    <script>
    lucide.createIcons();

    // Medical plans data
    const medicalPlans = [
      {
        name: 'Allianz Medicure',
        coverage: 500000,
        list: ['Allianz Medicure Plan 1', 'Allianz Medicure Plan 2', 'Allianz Medicure Plan 3'],
        price: 949,
        company: 'Allianz General Insurance Company (Malaysia) Berhad',
      },
      {
        name: 'Zurich ZMedProtect',
        coverage: 1000000,
        list: ['Zurich ZMedProtect Plan 1', 'Zurich ZMedProtect Plan 2', 'Zurich ZMedProtect Plan 3'],
        price: 350,
        company: 'Zurich Insurance Malaysia Berhad',
      },
      {
        name: 'SmartCare Optimum Plus Plan 1',
        coverage: 2100000,
        list: ['SmartCare Optimum Plus Plan 1', 'SmartCare Optimum Plus Plan 2', 'SmartCare Optimum Plus Plan 3'],
        price: 1441,
        company: 'Generali Insurance Malaysia Berhad',
      },
    ];

    function findPlanByPolicyName(policyName) {
      let plan = medicalPlans.find(p => p.name === policyName);
      if (!plan) {
        plan = medicalPlans.find(p => p.list && p.list.includes(policyName));
      }
      return plan;
    }

    function formatCurrency(amount) {
      return `RM ${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function calculateDates() {
      const today = new Date();
      const startDate = new Date(today);
      startDate.setDate(today.getDate() + 1); // Start tomorrow
      
      const endDate = new Date(startDate);
      endDate.setFullYear(startDate.getFullYear() + 1); // One year later
      
      return {
        start: startDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }),
        end: endDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' })
      };
    }

    function calculatePremium(grossPremium) {
      const serviceTax = 0; // 0.00%
      const serviceTaxAmount = grossPremium * (serviceTax / 100);
      const totalPremium = grossPremium + serviceTaxAmount;
      const commissionRate = 15.00;
      const commission = grossPremium * (commissionRate / 100);
      
      return {
        gross: grossPremium,
        serviceTax: serviceTaxAmount,
        total: totalPremium,
        commission: commission
      };
    }

    // Load summary data
    document.addEventListener('DOMContentLoaded', () => {
      const selectedPlanName = sessionStorage.getItem('selectedPlanName') || 'Allianz Medicure Plan 1';
      const plan = findPlanByPolicyName(selectedPlanName);
      
      if (plan) {
        document.getElementById('insurance-plan').textContent = selectedPlanName;
        document.getElementById('company-name').textContent = plan.company || 'Allianz General Insurance Company (Malaysia) Berhad';
        
        const premium = calculatePremium(plan.price);
        const stampDuty = 10.00;
        
        document.getElementById('gross-premium').textContent = formatCurrency(premium.gross);
        document.getElementById('service-tax').textContent = formatCurrency(premium.serviceTax);
        document.getElementById('total-premium').textContent = formatCurrency(premium.total);
        document.getElementById('commission').textContent = formatCurrency(premium.commission);
        document.getElementById('stamp-duty').textContent = formatCurrency(stampDuty);
      }
      
      const dates = calculateDates();
      document.getElementById('start-date').textContent = dates.start;
      document.getElementById('end-date').textContent = dates.end;
    });

    function submitApplication() {
      if (confirm('Are you sure you want to submit your application?')) {
        // Get selected plan name before clearing (to pass to next page)
        const selectedPlanName = sessionStorage.getItem('selectedPlanName') || 'Insurance Policy';
        
        // Clear all purchase-related session storage
        const keysToRemove = [
          'selectedPlanName',
          'pendingPurchasePlanIndex',
          'filter_dob',
          'filter_gender',
          'filter_annual-limit',
          'filter_plan-type',
          'form_application',
          'form_health',
          'form_autodebit',
          'not_primary_cardholder',
          'purchaseStep1',
          'purchaseStep2'
        ];

        keysToRemove.forEach(key => {
          sessionStorage.removeItem(key);
        });
        
        // Redirect to application complete page with plan name in URL
        window.location.href = `application-complete.html?planName=${encodeURIComponent(selectedPlanName)}`;
      }
    }
  </script>
  </body>
</html>

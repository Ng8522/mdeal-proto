<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Plans - InsureMart</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #FF5B61;
      --secondary-color: #F59E0B;
      --accent-color: #FF4A50;
      --text-primary: #1E293B;
      --text-secondary: #86868B;
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8FAFC;
      --border-color: #E5E5EA;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #FFF5F5 0%, #FFEBEB 100%);
      color: var(--text-primary);
      overflow-x: hidden;
      font-size: 14px;
    }

    .app {
      max-width: 428px;
      margin: 0 auto;
      background: linear-gradient(180deg, #FFF5F5 0%, #FFEBEB 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 30px rgba(255, 91, 97, 0.15);
      position: relative;
    }

    /* Fixed Header */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 428px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      z-index: 30;
    }

    .header-title {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .back-btn-header {
      background: transparent;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-primary);
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .back-btn-header:hover {
      background: var(--bg-secondary);
    }

    .header-title-content {
      flex: 1;
    }

    .header-title-content h1 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .header-title-content p {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .plan-selector {
      padding: 0.75rem 1rem;
    }

    .plan-nav {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .nav-btn {
      background: var(--bg-secondary);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-primary);
      transition: background 0.2s;
    }

    .nav-btn:hover {
      background: var(--border-color);
    }

    .plan-info-center {
      flex: 1;
      text-align: center;
    }

    .plan-color-bar {
      height: 6px;
      width: 64px;
      border-radius: 999px;
      margin: 0 auto 0.5rem;
    }

    .plan-name-display {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
    }

    .highlight-actions {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      width: 70px;
    }

    .purchase-plan-btn,
    .remove-plan-btn {
      flex-shrink: 0;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 0.35rem;
      font-size: 0.65rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.2rem;
      width: 100%;
      height: 45px;
      flex-direction: column;
    }

    .purchase-plan-btn:hover,
    .remove-plan-btn:hover {
      background: var(--bg-secondary);
      border-color: var(--primary-color);
    }

    .purchase-plan-btn i,
    .remove-plan-btn i {
      color: var(--text-primary);
    }

    .purchase-plan-btn i,
    .remove-plan-btn i {
      width: 14px;
      height: 14px;
    }

    .dots-indicator {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .dot {
      height: 8px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .dot.active {
      width: 24px;
    }

    .dot.inactive {
      width: 8px;
      background: var(--text-secondary);
      opacity: 0.3;
    }

    /* Spacer for fixed header */
    .header-spacer {
      height: 72px;
    }

    @media (max-width: 428px) {
      .header-spacer {
        height: 72px;
      }
    }

    /* Main Content */
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 120px;
    }

    /* Compare Plans Cards Container */
    .compare-plans-container {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding: 0.75rem;
    }

    .compare-plan-card {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    /* Highlight Card */
    .highlight-card {
      padding: 0.75rem;
      border-radius: 10px;
      background: white;
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .highlight-icon {
      flex-shrink: 0;
      width: 25%;
      max-width: 60px;
      height: 75px;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
      overflow: hidden;
    }

    .highlight-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: white;
      padding: 4px;
    }

    .highlight-icon span {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .highlight-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      min-width: 0;
    }

    .highlight-detail-item {
      display: flex;
      flex-direction: column;
    }

    .highlight-plan-name {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      line-height: 1.2;
    }

    .highlight-plan-name {
      font-size: 0.8125rem;
      font-weight: 700;
      margin-bottom: 0.2rem;
      line-height: 1.2;
      color: var(--text-primary);
    }

    .highlight-label {
      font-size: 0.6875rem;
      color: var(--text-secondary);
      margin-bottom: 0.1rem;
    }

    .highlight-value {
      font-size: 0.8125rem;
      font-weight: 700;
      line-height: 1.2;
      color: var(--text-primary);
    }


    /* Feature Categories */
    .feature-categories {
      margin-top: 1rem;
      display: none;
    }

    .feature-categories.show {
      display: block;
    }

    .show-benefits-btn {
      width: calc(100% - 2rem);
      margin: 1rem;
      padding: 0.875rem 1rem;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .show-benefits-btn:hover {
      background: var(--bg-secondary);
      border-color: var(--primary-color);
      box-shadow: 0 2px 12px rgba(255, 91, 97, 0.15);
    }

    .show-benefits-btn i {
      width: 18px;
      height: 18px;
      transition: transform 0.2s;
    }

    .show-benefits-btn.active i {
      transform: rotate(180deg);
    }

    /* Compare Benefits Section */
    .compare-benefits-section {
      padding: 1rem;
      margin-top: 1rem;
    }

    .compare-benefits-btn {
      width: 100%;
      padding: 0.625rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }

    .compare-benefits-btn:hover {
      background: #FF4A50;
    }

    .compare-benefits-btn i {
      width: 16px;
      height: 16px;
    }

    /* Recommended Plans Section */
    .recommended-section {
      padding: 1rem;
      margin-top: 1rem;
    }

    .recommended-section-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .recommended-plans-scroll {
      display: flex;
      gap: 0.75rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .recommended-plans-scroll::-webkit-scrollbar {
      display: none;
    }

    .recommended-plan-card {
      flex-shrink: 0;
      width: 200px;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 0.75rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .recommended-plan-card:hover {
      border-color: var(--primary-color);
      box-shadow: 0 4px 12px rgba(255, 91, 97, 0.15);
      transform: translateY(-2px);
    }

    .recommended-plan-logo {
      width: 100%;
      height: 60px;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 0.25rem;
    }

    .recommended-plan-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 4px;
    }

    .recommended-plan-logo span {
      font-weight: 700;
      font-size: 0.875rem;
      color: var(--primary-color);
    }

    .recommended-plan-name {
      font-size: 0.8125rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
      margin-bottom: 0.25rem;
    }

    .recommended-plan-price {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.125rem;
    }

    .recommended-plan-label {
      font-size: 0.6875rem;
      color: var(--text-secondary);
      margin-bottom: 0.125rem;
    }

    .recommended-plan-limit {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .recommended-plan-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .recommended-plan-btn {
      width: 100%;
      padding: 0.5rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .recommended-plan-btn:hover {
      background: #FF4A50;
    }

    .category-item {
      border-bottom: 1px solid var(--border-color);
    }

    .category-features {
      padding: 0.5rem 1rem;
    }

    .feature-item {
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .feature-item:last-child {
      border-bottom: none;
    }

    .feature-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }

    .feature-value {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .feature-value.not-included {
      color: var(--text-secondary);
    }

    .feature-value.as-charged {
      color: #16a34a;
    }

    .check-icon {
      width: 16px;
      height: 16px;
      color: #16a34a;
    }

    .minus-icon {
      width: 16px;
      height: 16px;
      color: var(--text-secondary);
    }

    /* Fixed Bottom Actions */
    .fixed-bottom {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 428px;
      background: var(--bg-primary);
      border-top: 1px solid var(--border-color);
      padding: 1rem;
      z-index: 30;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .action-btn {
      width: 100%;
      padding: 0.875rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .action-btn-outline {
      background: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }

    .action-btn-outline:hover {
      background: rgba(234, 88, 12, 0.1);
    }

    .action-btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .action-btn-primary:hover {
      background: #FF4A50;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
    }

    .empty-state i {
      width: 64px;
      height: 64px;
      margin-bottom: 1rem;
      opacity: 0.5;
      color: var(--text-secondary);
    }

    .empty-state p {
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .empty-state-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.875rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .empty-state-btn:hover {
      background: #FF4A50;
    }

    /* Data Sharing Terms modal */
    .terms-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1100;
    }

    .terms-modal.active {
      display: flex;
    }

    .terms-modal-content {
      width: calc(100% - 2rem);
      max-width: 400px;
      max-height: 70vh;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    @media (max-width: 480px) {
      .terms-modal-content {
        max-width: 360px;
        margin: 0 1rem;
      }
    }

    @media (max-height: 700px) {
      .terms-modal-content {
        max-height: 65vh;
      }
      .terms-modal-header {
        padding: 0.85rem 1rem 0.5rem;
      }
      .terms-modal-body {
        padding: 0.75rem 1rem;
        font-size: 0.8rem;
      }
      .terms-modal-footer {
        padding: 0.6rem 1rem 0.9rem;
      }
    }

    .terms-modal-header {
      padding: 1.25rem 1.25rem 0.75rem;
      border-bottom: 1px solid #f2f2f7;
    }

    .terms-modal-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .terms-modal-body {
      padding: 1rem 1.25rem;
      overflow-y: auto;
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text-primary);
      background: #fafafa;
    }

    .terms-modal-body p {
      margin-bottom: 0.75rem;
    }

    .terms-modal-footer {
      padding: 0.75rem 1.25rem 1.25rem;
      display: flex;
      gap: 0.75rem;
      border-top: 1px solid #f2f2f7;
      background: #fff;
    }

    .terms-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 999px;
      border: 1px solid #e5e5ea;
      background: #f5f5f7;
      color: var(--text-primary);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
    }

    .terms-btn.primary {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: #fff;
    }

    .terms-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .terms-btn.primary:disabled {
      background: #ccc;
      border-color: #ccc;
      color: #999;
    }

    /* Plan Detail Modal */
    .plan-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 428px;
      height: 100vh;
      background: white;
      z-index: 1000;
      overflow-y: auto;
    }

    .plan-detail-modal.active {
      display: block;
    }

    .plan-detail-header {
      background: white;
      padding: 1rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .plan-detail-header h3 {
      color: var(--text-primary);
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
    }

    .close-modal-btn {
      background: var(--bg-secondary);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-primary);
    }

    .plan-detail-content {
      padding: 1.5rem 1.25rem;
    }

    .plan-company-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .company-logo {
      width: 40px;
      height: 40px;
      background: #34C759;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 0.75rem;
      overflow: hidden;
    }

    .company-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #fff;
      padding: 2px;
    }

    .company-name {
      font-size: 0.875rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .action-buttons-top {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .action-btn-top {
      flex: 1;
      min-width: calc(33.333% - 0.35rem);
      max-width: calc(50% - 0.25rem);
      padding: 0.5rem 0.625rem;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      background: white;
      color: var(--primary-color);
      font-size: 0.7rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      transform: scale(1) !important;
      box-sizing: border-box;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .action-btn-top span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 1;
      min-width: 0;
    }

    .action-btn-top i {
      flex-shrink: 0;
    }

    .action-btn-top:hover {
      background: var(--primary-color);
      color: white;
      transform: scale(1) !important;
    }

    .action-btn-top:active {
      transform: scale(1) !important;
    }

    .action-btn-top:focus {
      transform: scale(1) !important;
      outline: none;
    }

    .action-btn-top.primary {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .action-btn-top.primary:hover {
      background: #FF4A50;
    }

    .plan-select-section {
      margin-bottom: 1.5rem;
    }

    .plan-select-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      display: block;
    }

    .plan-select-dropdown {
      width: 100%;
      padding: 0.875rem;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      background: white;
      color: var(--text-primary);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23EA580C' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.875rem center;
      background-size: 12px;
      padding-right: 2.5rem;
    }

    .pricing-section {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .pricing-info {
      flex: 1;
    }

    .pricing-row {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
    }

    .pricing-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .pricing-amount {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pricing-period {
      font-size: 0.875rem;
      color: var(--primary-color);
    }

    .daily-price {
      background: rgba(234, 88, 12, 0.15);
      padding: 0.5rem 0.75rem;
      border-radius: 20px;
      display: inline-block;
      margin-top: 0.5rem;
    }

    .daily-price-text {
      font-size: 0.875rem;
      color: var(--primary-color);
      font-weight: 500;
    }

    .features-section {
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .features-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .feature-pill {
      background: var(--primary-color);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      border: none;
      white-space: nowrap;
    }

    .show-more-link {
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 500;
      text-decoration: none;
      display: inline-block;
      margin-top: 0.5rem;
    }

    .annual-limit-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 1rem;
    }

    .annual-limit-label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .annual-limit-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Product Disclosure Sheet Dropdown */
    .pdf-dropdown {
      display: none;
      margin-top: 1rem;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      animation: slideDown 0.3s ease-out;
    }

    .pdf-dropdown.active {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pdf-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .pdf-item {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.625rem 0.875rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: inherit;
    }

    .pdf-item:hover {
      border-color: var(--primary-color);
      box-shadow: var(--shadow);
    }

    .pdf-info {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      flex: 1;
      min-width: 0;
    }

    .pdf-icon {
      width: 32px;
      height: 32px;
      background: rgba(234, 88, 12, 0.1);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      flex-shrink: 0;
    }

    .pdf-details {
      flex: 1;
      min-width: 0;
    }

    .pdf-name {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pdf-size {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .pdf-arrow {
      width: 18px;
      height: 24px;
      color: var(--text-secondary);
      flex-shrink: 0;
    }
  </style>
  </head>
  <body>
    <div class="app">
      <!-- Fixed Header -->
      <div class="fixed-header">
        <div class="header-title">
          <button class="back-btn-header"
            onclick="window.location.href='medical-plan.html'"
            aria-label="Back">
            <i data-lucide="arrow-left"></i>
          </button>
          <div class="header-title-content">
            <h1>Compare Plans</h1>
            <p id="plans-count">Swipe to compare 0 plans</p>
          </div>
        </div>
        <div class="plan-selector" id="plan-selector" style="display: none;">
          <div class="plan-nav">
            <button class="nav-btn" onclick="goToPrevious()"
              aria-label="Previous plan">
              <i data-lucide="chevron-left"></i>
            </button>
            <div class="plan-info-center">
              <div class="plan-color-bar" id="plan-color-bar"></div>
              <p class="plan-name-display" id="plan-name-display"></p>
            </div>
            <button class="nav-btn" onclick="goToNext()" aria-label="Next plan">
              <i data-lucide="chevron-right"></i>
            </button>
          </div>
          <div class="dots-indicator" id="dots-indicator"></div>
        </div>
      </div>

      <!-- Spacer for fixed header -->
      <div class="header-spacer"></div>

      <!-- Main Content -->
      <main class="main-content" id="main-content">
        <!-- Content will be rendered here -->
      </main>

      <!-- Plan Detail Modal -->
      <div class="plan-detail-modal" id="plan-detail-modal">
        <div class="plan-detail-header">
          <h3>Plan Details</h3>
          <button class="close-modal-btn" onclick="closePlanDetails()">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div class="plan-detail-content" id="plan-detail-content">
          <!-- Plan details will be rendered here -->
        </div>
      </div>

      <!-- Data Sharing Terms Modal -->
      <div class="terms-modal" id="terms-modal">
        <div class="terms-modal-content">
          <div class="terms-modal-header">
            <h3 class="terms-modal-title">Data Sharing Terms &amp;
              Conditions</h3>
          </div>
          <div class="terms-modal-body">
            <p><strong>By agreeing to these terms, you expressly acknowledge and
                agree to the following:</strong></p>
            <p>
              You hereby expressly authorize <strong></strong> to share your
              Personal Data with the Insurance Provider
              and Insurance Agency (hereinafter referred to as "Partner"). You
              further consent to the Partner's Privacy Policy
              and acknowledge that your Personal Data will be used, processed,
              and handled in accordance with the Partner's
              Privacy Policy.
            </p>
            <p>
              You acknowledge that once your Personal Data is shared with the
              Partner, the Partner will have sole and full
              control over the copy of your Personal Data, and you will be
              required to contact the Partner directly for any
              matters related to your Personal Data.
            </p>
            <p>
              You expressly consent to the transfer of your Personal Data to a
              location outside Malaysia, subject to the terms
              outlined in the Partner's Privacy Policy.
            </p>
            <p>
              <strong></strong> shall be released from all obligations and
              responsibilities related to the copy of
              Personal Data shared with the Partner. For clarity,
              <strong></strong> will ensure that any Personal Data
              retained under its control is processed in accordance with
              <strong></strong>'s Privacy Policy and
              applicable laws.
            </p>
            <p>
              You may withdraw your consent for further disclosure of your
              Personal Data at any time by submitting a request to
              <a href="mailto:support@mdeal.com.my"></a>. However, such
              withdrawal may result in the Partner
              or <strong></strong> declining, refusing, or making services
              inaccessible to you. Please note that any
              withdrawal of consent will not affect Personal Data previously
              shared, for which you must contact the Partner
              directly.
            </p>
          </div>
          <div class="terms-modal-footer">
            <button type="button" class="terms-btn"
              onclick="closeTermsModal()">Close</button>
            <button type="button" id="accept-terms-btn"
              class="terms-btn primary" onclick="acceptTermsAndProceed()"
              disabled>I accept</button>
          </div>
        </div>
      </div>
    </div>

    <script>
    lucide.createIcons();

    // Available medical plans (should mirror medical-plan.html)
    const medicalPlans = [
      {
        name: 'Zurich ZMedProtect',
        coverage: 'RM 1,000,000',
        price: 350,
        type: 'normal',
        minAge: 0,
        maxAge: 80,
        gender: 'both',
        color: '#0ea5e9',
        list: ['Zurich ZMedProtect Plan 1', 'Zurich ZMedProtect Plan 2', 'Zurich ZMedProtect Plan 3'],
        logo: 'zurich-logo.svg',
        planFeatures: {
          overallAnnualLimit: 'RM 1,000,000',
          roomAndBoard: 'RM 300/day',
          ambulanceFee: 'As Charged',
          anaesthetistFee: 'As Charged',
          dailyCashAllowance: 'RM 80',
          daySurgery: 'As Charged',
          emergencyOutpatient: 'As Charged (Max 30 days)',
          entryAge: 'Age 0 - Age 80',
          hospitalSupplies: 'As Charged',
          inHospitalPhysician: 'As Charged',
          intensiveCareUnit: 'As Charged (Max 30 days)',
          operatingTheatre: 'As Charged',
          outpatientCancer: 'As Charged',
          outpatientKidney: 'As Charged',
          postHospitalisation: 'As Charged (Max 60 days)',
          preHospitalisation: 'As Charged (Max 60 days)',
          nurseAndBoard: 'RM 150',
          surgicalFees: 'As Charged',
          compassionateAllowance: '-',
          emergencyDental: '-',
          homeNursingCare: '-',
          organTransplant: '-',
        },
      },
      {
        name: 'Allianz Medicure',
        coverage: 'RM 500,000',
        price: 949,
        type: 'normal',
        minAge: 0,
        maxAge: 80,
        gender: 'both',
        color: '#2563eb',
        list: ['Allianz Medicure Plan 1', 'Allianz Medicure Plan 2', 'Allianz Medicure Plan 3'],
        logo: 'Allianz.svg',
        planFeatures: {
          overallAnnualLimit: 'RM 500,000',
          roomAndBoard: 'RM 250/day',
          ambulanceFee: 'As Charged',
          anaesthetistFee: 'As Charged',
          dailyCashAllowance: 'RM 50',
          daySurgery: 'As Charged',
          emergencyOutpatient: 'As Charged (Max 30 days)',
          entryAge: 'Age 0 - Age 80',
          hospitalSupplies: 'As Charged',
          inHospitalPhysician: 'As Charged',
          intensiveCareUnit: 'As Charged (Max 20 days)',
          operatingTheatre: 'As Charged',
          outpatientCancer: 'As Charged',
          outpatientKidney: 'As Charged',
          postHospitalisation: 'As Charged (Max 30 days)',
          preHospitalisation: 'As Charged (Max 30 days)',
          nurseAndBoard: 'RM 120',
          surgicalFees: 'As Charged',
          compassionateAllowance: '-',
          emergencyDental: '-',
          homeNursingCare: '-',
          organTransplant: '-',
        },
      },
      {
        name: 'SmartCare Optimum Plus Plan 1',
        coverage: 'RM 2,100,000',
        price: 1441,
        type: 'normal',
        minAge: 0,
        maxAge: 80,
        gender: 'both',
        color: '#16a34a',
        list: ['SmartCare Optimum Plus Plan 1', 'SmartCare Optimum Plus Plan 2', 'SmartCare Optimum Plus Plan 3'],
        logo: 'Assicurazioni_Generali_logo.png',
        planFeatures: {
          overallAnnualLimit: 'RM 2,100,000',
          roomAndBoard: 'RM 600/day',
          ambulanceFee: 'As Charged',
          anaesthetistFee: 'As Charged',
          dailyCashAllowance: 'RM 120',
          daySurgery: 'As Charged',
          emergencyOutpatient: 'As Charged (Max 60 days)',
          entryAge: 'Age 0 - Age 80',
          hospitalSupplies: 'As Charged',
          inHospitalPhysician: 'As Charged',
          intensiveCareUnit: 'As Charged (Max 45 days)',
          operatingTheatre: 'As Charged',
          outpatientCancer: 'RM 50,000/year',
          outpatientKidney: 'RM 20,000/year',
          postHospitalisation: 'As Charged (Max 90 days)',
          preHospitalisation: 'As Charged (Max 60 days)',
          nurseAndBoard: 'RM 200',
          surgicalFees: 'As Charged',
          compassionateAllowance: 'RM 1,000',
          emergencyDental: 'As Charged',
          homeNursingCare: 'RM 150',
          organTransplant: 'RM 30,000',
        },
      },
    ];

    const featureLabels = {
      overallAnnualLimit: 'Overall Annual Limit',
      roomAndBoard: 'Room & Board',
      ambulanceFee: 'Ambulance Fee',
      anaesthetistFee: 'Anaesthetist Fee',
      dailyCashAllowance: 'Daily Cash Allowance at Gov Hospital',
      daySurgery: 'Day Surgery',
      emergencyOutpatient: 'Emergency Accidental Outpatient Treatment',
      entryAge: 'Entry Age',
      hospitalSupplies: 'Hospital Supplies and Services',
      inHospitalPhysician: 'In-Hospital Physician Visit',
      intensiveCareUnit: 'Intensive Care Unit (ICU)',
      operatingTheatre: 'Operating Theatre',
      outpatientCancer: 'Outpatient Cancer Treatment',
      outpatientKidney: 'Outpatient Kidney Dialysis Treatment',
      postHospitalisation: 'Post-Hospitalisation Benefit',
      preHospitalisation: 'Pre-Hospitalisation Benefit',
      nurseAndBoard: 'Nurse and Board',
      surgicalFees: 'Surgical Fees',
      compassionateAllowance: 'Compassionate Allowance',
      emergencyDental: 'Emergency Accidental Dental Care',
      homeNursingCare: 'Home Nursing Care',
      organTransplant: 'Organ Transplant',
    };

    const featureCategories = [
      {
        name: 'Core Benefits',
        features: ['overallAnnualLimit', 'roomAndBoard', 'nurseAndBoard', 'surgicalFees', 'intensiveCareUnit'],
      },
      {
        name: 'Hospital Services',
        features: ['operatingTheatre', 'hospitalSupplies', 'inHospitalPhysician', 'anaesthetistFee', 'ambulanceFee', 'daySurgery'],
      },
      {
        name: 'Outpatient',
        features: ['emergencyOutpatient', 'outpatientCancer', 'outpatientKidney'],
      },
      {
        name: 'Pre & Post Hospital',
        features: ['preHospitalisation', 'postHospitalisation'],
      },
      {
        name: 'Additional Benefits',
        features: ['dailyCashAllowance', 'compassionateAllowance', 'emergencyDental', 'homeNursingCare', 'organTransplant'],
      },
      {
        name: 'Eligibility',
        features: ['entryAge'],
      },
    ];

    let currentPlanIndex = 0;
    let comparePlans = [];
    let benefitsVisible = false;

    // Get plans from comparison list
    function getComparePlans() {
      const compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
      const plans = compareList.map(item => {
        // First try to find plan by exact name match
        let plan = medicalPlans.find(p => p.name === item.name);
        
        // If not found, try to find plan where item.name is in the plan's list (variant)
        if (!plan) {
          plan = medicalPlans.find(p => p.list && p.list.includes(item.name));
        }
        
        if (plan) {
          // Override the name with the stored variant name if it's different
          return { ...plan, name: item.name, compareIndex: item.index };
        }
        return null;
      }).filter(plan => plan !== null);
      
      // Sort by price (lowest to highest)
      return plans.sort((a, b) => {
        const priceA = a.price || 0;
        const priceB = b.price || 0;
        return priceA - priceB;
      });
    }

    // Render value
    function renderValue(value) {
      if (value === '-') {
        return `
          <div class="feature-value not-included">
            <i data-lucide="minus" class="minus-icon"></i>
            <span>Not included</span>
          </div>
        `;
      }
      if (value === 'As Charged') {
        return `
          <div class="feature-value as-charged">
            <i data-lucide="check" class="check-icon"></i>
            <span>As Charged</span>
          </div>
        `;
      }
      return `<span class="feature-value">${value}</span>`;
    }

    // Render comparison
    function renderComparison() {
      comparePlans = getComparePlans();
      const mainContent = document.getElementById('main-content');
      const planSelector = document.getElementById('plan-selector');
      const plansCount = document.getElementById('plans-count');

      // Hide swipe navigation
      if (planSelector) {
        planSelector.style.display = 'none';
      }

      // If no plans in sessionStorage, show empty state
      if (comparePlans.length === 0) {
        if (plansCount) {
          plansCount.textContent = 'Compare 0 plans';
        }
        mainContent.innerHTML = `
          <div class="empty-state">
            <i data-lucide="search-x"></i>
            <p>No plans selected for comparison yet.</p>
            <button class="empty-state-btn" onclick="window.location.href='medical-plan.html'">
              Add plans to compare
            </button>
          </div>
        `;
        lucide.createIcons();
        return;
      }

      if (plansCount) {
        plansCount.textContent = `Comparing ${comparePlans.length} plan${comparePlans.length > 1 ? 's' : ''}`;
      }
      
      renderAllPlans();
    }

    // Render all plans as cards
    function renderAllPlans() {
      if (comparePlans.length === 0) return;

      const mainContent = document.getElementById('main-content');
      
      const plansHTML = comparePlans.map((plan, index) => {
        const price = plan.price || 0;
        const priceFormatted = `RM ${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        const planInitials = plan.name.substring(0, 2).toUpperCase();

        return `
          <div class="compare-plan-card">
            <div class="highlight-card">
              <div class="highlight-icon">
                ${plan.logo ? `
                  <img src="insurance-img/${plan.logo}" alt="${plan.name} logo"
                    onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${planInitials}</span>';">
                ` : `
                  <span>${planInitials}</span>
                `}
              </div>
              <div class="highlight-details">
                <p class="highlight-plan-name">${plan.name}</p>
                <div class="highlight-detail-item">
                  <p class="highlight-label">Annual Premium</p>
                  <p class="highlight-value">${priceFormatted}</p>
                </div>
                <div class="highlight-detail-item">
                  <p class="highlight-label">Annual Limit</p>
                  <p class="highlight-value">${plan.planFeatures?.overallAnnualLimit || plan.coverage}</p>
                </div>
              </div>
              <div class="highlight-actions">
                <button class="purchase-plan-btn" onclick="purchasePlan('${plan.name}')" title="Purchase">
                  <i data-lucide="shopping-cart"></i>
                  <span style="font-size: 0.6rem;">Purchase</span>
                </button>
                <button class="remove-plan-btn" onclick="removePlanFromCompare('${plan.name}')" title="Remove from Compare">
                  <i data-lucide="x"></i>
                  <span style="font-size: 0.6rem;">Remove</span>
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');

      // Add Compare Benefits button after plans if there are plans
      const buttonHTML = comparePlans.length > 0 ? `
        <div class="compare-benefits-section">
          <button class="compare-benefits-btn" onclick="window.location.href='compare-benefits.html'">
            <i data-lucide="git-compare"></i>
            <span>Compare Benefits</span>
          </button>
        </div>
      ` : '';
      
      // Add Recommended Plans section
      const recommendedHTML = renderRecommendedPlans();
      
      mainContent.innerHTML = plansHTML + buttonHTML + recommendedHTML;
      lucide.createIcons();
    }

    // Get recommended plans (exclude plans already in compare list)
    function getRecommendedPlans() {
      const compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
      const comparePlanNames = compareList.map(item => item.name);
      
      // Filter out plans that are already in compare list
      const recommended = medicalPlans.filter(plan => {
        // Check if plan name matches
        if (comparePlanNames.includes(plan.name)) return false;
        // Check if any variant matches
        if (plan.list) {
          return !plan.list.some(variant => comparePlanNames.includes(variant));
        }
        return true;
      });
      
      // Return up to 5 recommended plans
      return recommended.slice(0, 5);
    }

    // Render recommended plans section
    function renderRecommendedPlans() {
      const recommended = getRecommendedPlans();
      
      if (recommended.length === 0) {
        return '';
      }
      
      const plansHTML = recommended.map(plan => {
        const price = plan.price || 0;
        const priceFormatted = `RM ${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        const coverage = typeof plan.coverage === 'number' ? plan.coverage : parseInt(plan.coverage.replace(/[RM,\s]/g, ''));
        const coverageFormatted = `RM ${coverage.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        const planInitials = plan.name.substring(0, 2).toUpperCase();
        
        return `
          <div class="recommended-plan-card" onclick="viewRecommendedPlanDetails('${plan.name}')">
            <div class="recommended-plan-logo">
              ${plan.logo ? `
                <img src="insurance-img/${plan.logo}" alt="${plan.name} logo"
                  onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${planInitials}</span>';">
              ` : `
                <span>${planInitials}</span>
              `}
            </div>
            <p class="recommended-plan-name">${plan.name}</p>
            <div>
              <p class="recommended-plan-label">Annual Premium</p>
              <p class="recommended-plan-price">${priceFormatted}</p>
            </div>
            <div>
              <p class="recommended-plan-label">Annual Limit</p>
              <p class="recommended-plan-limit">${coverageFormatted}</p>
            </div>
            <button class="recommended-plan-btn" onclick="event.stopPropagation(); addRecommendedToCompare('${plan.name}')">
              Add to Compare
            </button>
          </div>
        `;
      }).join('');
      
      return `
        <div class="recommended-section">
          <h3 class="recommended-section-title">Recommended Medical Plans</h3>
          <div class="recommended-plans-scroll">
            ${plansHTML}
          </div>
        </div>
      `;
    }

    // Add recommended plan to compare
    function addRecommendedToCompare(planName) {
      const plan = medicalPlans.find(p => p.name === planName);
      if (!plan) return;
      
      let compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
      
      // Check if maximum of 3 plans already reached
      if (compareList.length >= 3) {
        alert('Maximum of 3 plans can be compared. Please remove a plan first.');
        return;
      }
      
      // Add the base plan name (first variant)
      const planNameToStore = plan.list ? plan.list[0] : plan.name;
      compareList.push({ name: planNameToStore, index: -1 });
      
      sessionStorage.setItem('comparePlans', JSON.stringify(compareList));
      
      // Re-render the page
      renderComparison();
    }

    // View recommended plan details - open modal (same as medical-plan.html)
    function viewRecommendedPlanDetails(planName) {
      const plan = medicalPlans.find(p => p.name === planName);
      if (!plan) return;

      // Calculate daily price
      const annualPrice = plan.price || 0;
      const dailyPrice = (annualPrice / 365).toFixed(2);

      const detailContent = document.getElementById('plan-detail-content');
      detailContent.setAttribute('data-plan-name', planName);
      detailContent.innerHTML = `
        <div class="plan-company-info">
          <div class="company-logo">
            ${plan.logo ? `
              <img src="insurance-img/${plan.logo}" alt="${plan.name} logo"
                onerror="this.style.display='none'; this.parentElement.innerHTML='<span style\\='font-weight: 700; font-size: 0.85rem;\\'>${plan.name.substring(0, 2).toUpperCase()}</span>';">
            ` : `
              <span style="font-weight: 700; font-size: 0.85rem;">
                ${plan.name.substring(0, 2).toUpperCase()}
              </span>
            `}
          </div>
          <div class="company-name">${plan.name}</div>
        </div>

        <div class="action-buttons-top">
          <button class="action-btn-top" onclick="viewProductSheet()">
            <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
            <span>Product Disclosure Sheet</span>
          </button>
          <button class="action-btn-top primary" onclick="purchaseRecommendedPlan('${planName}')">
            <i data-lucide="shopping-cart" style="width: 16px; height: 16px;"></i>
            <span>Purchase</span>
          </button>
        </div>

        <div class="plan-select-section">
          <label class="plan-select-label">Select Your Policy Plan:</label>
          <select class="plan-select-dropdown" id="plan-variant">
            ${plan.list ? plan.list.map(item => `
              <option value="${item}" ${item === plan.list[0] ? 'selected' : ''}>${item}</option>
            `).join('') : `
              <option value="${plan.name}" selected>${plan.name}</option>
            `}
          </select>
        </div>

        <div class="pricing-section">
          <div class="pricing-info">
            <div class="pricing-row">
              <span class="pricing-label">From</span>
              <div class="pricing-amount">
                <i data-lucide="info" style="width: 18px; height: 18px; color: var(--text-secondary);"></i>
                RM ${annualPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
              </div>
              <span class="pricing-period">per annum</span>
            </div>
            <div class="daily-price">
              <div class="daily-price-text">RM ${parseFloat(dailyPrice).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} per day</div>
            </div>
          </div>
        </div>

        <div class="features-section">
          <div class="features-pills" id="features-pills-recommended">
            ${plan.features ? plan.features.slice(0, 4).map(feature => `
              <button class="feature-pill">${feature}</button>
            `).join('') : ''}
            ${plan.features && plan.features.length > 4 ? `
              <div id="more-features-recommended" style="display: none;">
                ${plan.features.slice(4).map(feature => `
                  <button class="feature-pill">${feature}</button>
                `).join('')}
              </div>
            ` : ''}
          </div>
          ${plan.features && plan.features.length > 4 ? `
            <a href="#" class="show-more-link" id="show-more-recommended" onclick="showMoreFeatures('recommended'); return false;">Show More</a>
            <a href="#" class="show-more-link" id="show-less-recommended" onclick="showLessFeatures('recommended'); return false;" style="display: none;">Show Less</a>
          ` : ''}
        </div>

        <div class="annual-limit-section">
          <div class="annual-limit-label">
            Annual Limit:
          </div>
          <div class="annual-limit-value">
            <i data-lucide="info" style="width: 18px; height: 18px; color: var(--text-secondary);"></i>
            ${typeof plan.coverage === 'number' ? `RM ${plan.coverage.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : plan.coverage}
          </div>
        </div>
      `;

      lucide.createIcons();
      document.getElementById('plan-detail-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close plan details modal
    function closePlanDetails() {
      document.getElementById('plan-detail-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    // View product sheet (same as medical-plan.html)
    function viewProductSheet() {
      const planDetailContent = document.getElementById('plan-detail-content');
      if (!planDetailContent) return;
      
      // Get the plan name from data attribute
      const planName = planDetailContent.getAttribute('data-plan-name');
      const plan = planName ? medicalPlans.find(p => p.name === planName) : null;
      
      // Check if dropdown already exists
      let dropdown = planDetailContent.querySelector('.pdf-dropdown');
      
      if (dropdown) {
        // Toggle existing dropdown
        dropdown.classList.toggle('active');
      } else {
        // Create new dropdown
        const actionButtons = planDetailContent.querySelector('.action-buttons-top');
        if (!actionButtons) return;
        
        // PDF files list - use plan data if available, otherwise use defaults
        const pdfFiles = [
          { name: 'Product Disclosure Sheet', url: plan?.productDisclosureSheet || '#' },
          { name: 'Brochure', url: plan?.brochure || '#' },
          { name: 'Certificate Wording', url: plan?.policyWording || '#' },
        ];

        const dropdownHTML = `
          <div class="pdf-dropdown active" id="pdf-dropdown">
            <div class="pdf-list" style="padding: 0.75rem;">
              ${pdfFiles.map((pdf, index) => `
                <a href="${pdf.url}" class="pdf-item" target="_blank" onclick="event.preventDefault(); openPDF('${pdf.url}', '${pdf.name}')">
                  <div class="pdf-info">
                    <div class="pdf-icon">
                      <i data-lucide="file-text" style="width: 18px; height: 18px;"></i>
                    </div>
                    <div class="pdf-details">
                      <div class="pdf-name">${pdf.name}</div>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="pdf-arrow"></i>
                </a>
              `).join('')}
            </div>
          </div>
        `;
        
        actionButtons.insertAdjacentHTML('afterend', dropdownHTML);
        lucide.createIcons();
      }
    }

    function openPDF(url, filename) {
      if (url !== '#') {
        window.open(url, '_blank');
      }
    }

    // Show more features
    function showMoreFeatures(id) {
      const moreFeatures = document.getElementById(`more-features-${id}`);
      const showMoreLink = document.getElementById(`show-more-${id}`);
      const showLessLink = document.getElementById(`show-less-${id}`);
      
      if (moreFeatures && showMoreLink && showLessLink) {
        moreFeatures.style.display = 'flex';
        moreFeatures.style.flexWrap = 'wrap';
        moreFeatures.style.gap = '0.5rem';
        showMoreLink.style.display = 'none';
        showLessLink.style.display = 'inline-block';
      }
    }

    // Show less features
    function showLessFeatures(id) {
      const moreFeatures = document.getElementById(`more-features-${id}`);
      const showMoreLink = document.getElementById(`show-more-${id}`);
      const showLessLink = document.getElementById(`show-less-${id}`);
      
      if (moreFeatures && showMoreLink && showLessLink) {
        moreFeatures.style.display = 'none';
        showMoreLink.style.display = 'inline-block';
        showLessLink.style.display = 'none';
      }
    }

    // Purchase recommended plan
    function purchaseRecommendedPlan(planName) {
      const plan = medicalPlans.find(p => p.name === planName);
      if (!plan) return;
      
      // Get the selected variant name if plan has variants
      let planNameToStore = plan.name;
      const variantSelect = document.getElementById('plan-variant');
      if (variantSelect) {
        planNameToStore = variantSelect.value;
      }
      
      // Store plan name for purchase flow
      sessionStorage.setItem('selectedPlanName', planNameToStore);
      
      // Close modal and show terms
      closePlanDetails();
      
      // Show Data Sharing Terms modal
      const modal = document.getElementById('terms-modal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        const acceptBtn = document.getElementById('accept-terms-btn');
        if (acceptBtn) {
          acceptBtn.disabled = true;
        }
        
        const modalBody = modal.querySelector('.terms-modal-body');
        if (modalBody) {
          modalBody.scrollTop = 0;
          
          const checkScrollPosition = () => {
            const scrollTop = modalBody.scrollTop;
            const scrollHeight = modalBody.scrollHeight;
            const clientHeight = modalBody.clientHeight;
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
            
            if (acceptBtn) {
              acceptBtn.disabled = !isAtBottom;
            }
          };
          
          modalBody.addEventListener('scroll', checkScrollPosition);
          setTimeout(checkScrollPosition, 100);
        }
      }
    }


    // Toggle benefits visibility
    function toggleBenefits() {
      benefitsVisible = !benefitsVisible;
      const featureCategories = document.getElementById('feature-categories');
      const showBtn = document.getElementById('show-benefits-btn');
      
      if (featureCategories && showBtn) {
        const btnSpan = showBtn.querySelector('span');
        
        if (benefitsVisible) {
          featureCategories.classList.add('show');
          showBtn.classList.add('active');
          if (btnSpan) btnSpan.textContent = 'Hide Benefits Details';
        } else {
          featureCategories.classList.remove('show');
          showBtn.classList.remove('active');
          if (btnSpan) btnSpan.textContent = 'Show Benefits Details';
        }
        
        // Recreate icons after text change
        lucide.createIcons();
      }
    }

    // Purchase plan
    function purchasePlan(planName) {
      // Store the plan name for purchase flow
      sessionStorage.setItem('selectedPlanName', planName);
      // Show Data Sharing Terms modal first (same as medical-plan.html)
      const modal = document.getElementById('terms-modal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Disable accept button initially
        const acceptBtn = document.getElementById('accept-terms-btn');
        if (acceptBtn) {
          acceptBtn.disabled = true;
        }
        
        // Set up scroll detection
        const modalBody = modal.querySelector('.terms-modal-body');
        if (modalBody) {
          // Reset scroll position
          modalBody.scrollTop = 0;
          
          // Check scroll position function
          const checkScrollPosition = () => {
            const scrollTop = modalBody.scrollTop;
            const scrollHeight = modalBody.scrollHeight;
            const clientHeight = modalBody.clientHeight;
            
            // Check if scrolled to bottom (with 10px tolerance)
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
            
            if (acceptBtn) {
              acceptBtn.disabled = !isAtBottom;
            }
          };
          
          // Add scroll event listener
          modalBody.addEventListener('scroll', checkScrollPosition);
          
          // Check initial state (in case content is short and already fully visible)
          setTimeout(checkScrollPosition, 100);
        }
      }
    }

    // Remove plan from comparison
    function removePlanFromCompare(planName) {
      if (confirm(`Remove "${planName}" from comparison?`)) {
        let compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
        compareList = compareList.filter(item => item.name !== planName);
        sessionStorage.setItem('comparePlans', JSON.stringify(compareList));
        
        // Adjust current index if needed
        if (currentPlanIndex >= compareList.length) {
          currentPlanIndex = Math.max(0, compareList.length - 1);
        }
        
        // Re-render comparison
        renderComparison();
      }
    }

    // Action functions
    function submitApplication() {
      // Show Data Sharing Terms modal first (same as medical-plan.html)
      const modal = document.getElementById('terms-modal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Disable accept button initially
        const acceptBtn = document.getElementById('accept-terms-btn');
        if (acceptBtn) {
          acceptBtn.disabled = true;
        }
        
        // Set up scroll detection
        const modalBody = modal.querySelector('.terms-modal-body');
        if (modalBody) {
          // Reset scroll position
          modalBody.scrollTop = 0;
          
          // Check scroll position function
          const checkScrollPosition = () => {
            const scrollTop = modalBody.scrollTop;
            const scrollHeight = modalBody.scrollHeight;
            const clientHeight = modalBody.clientHeight;
            
            // Check if scrolled to bottom (with 10px tolerance)
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
            
            if (acceptBtn) {
              acceptBtn.disabled = !isAtBottom;
            }
          };
          
          // Add scroll event listener
          modalBody.addEventListener('scroll', checkScrollPosition);
          
          // Check initial state (in case content is short and already fully visible)
          setTimeout(checkScrollPosition, 100);
        }
      }
    }

    function closeTermsModal() {
      const modal = document.getElementById('terms-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
        // Reset scroll position and button state
        const modalBody = modal.querySelector('.terms-modal-body');
        const acceptBtn = document.getElementById('accept-terms-btn');
        if (modalBody) {
          modalBody.scrollTop = 0;
          // Remove scroll event listener by cloning and replacing
          const newBody = modalBody.cloneNode(true);
          modalBody.parentNode.replaceChild(newBody, modalBody);
        }
        if (acceptBtn) {
          acceptBtn.disabled = true;
        }
      }
    }

    function acceptTermsAndProceed() {
      // Store selected plan information
      if (comparePlans.length > 0 && currentPlanIndex >= 0 && currentPlanIndex < comparePlans.length) {
        const currentPlan = comparePlans[currentPlanIndex];
        if (currentPlan) {
          // Store plan name in sessionStorage for purchase pages
          sessionStorage.setItem('selectedPlanName', currentPlan.name);
        }
      }
      
      // Continue to purchase flow
      closeTermsModal();
      window.location.href = 'purchase-step-1.html';
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      renderComparison();
    });
  </script>
  </body>
</html>

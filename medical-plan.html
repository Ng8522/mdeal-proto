<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Plans - InsureMart</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #FF5B61;
      --secondary-color: #F59E0B;
      --accent-color: #FF4A50;
      --text-primary: #1E293B;
      --text-secondary: #86868B;
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8FAFC;
      --border-color: #E5E5EA;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #FFF5F5 0%, #FFEBEB 100%);
      color: var(--text-primary);
    }

    .app {
      max-width: 428px;
      margin: 0 auto;
      background: linear-gradient(180deg, #FFF5F5 0%, #FFEBEB 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 30px rgba(255, 91, 97, 0.15);
    }

    /* Header */
    .home-header {
      background: linear-gradient(135deg, #FF5B61 0%, #FF4A50 50%, #FF3940 100%);
      padding: 1rem 1.25rem;
      box-shadow: 0 8px 32px rgba(255, 91, 97, 0.2);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-greeting {
      flex: 1;
    }

    .brand-name {
      font-size: 0.85rem;
      font-weight: 600;
      opacity: 0.9;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: white;
      margin-bottom: 0.25rem;
    }

    .user-greeting h2 {
      font-size: 2rem;
      font-weight: 600;
      color: white;
      margin: 0;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .back-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
    }

    .compare-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: white;
      position: relative;
      pointer-events: auto;
    }

    .compare-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .compare-btn i {
      pointer-events: none;
    }

    .compare-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: var(--secondary-color);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      border: 2px solid var(--primary-color);
    }

    /* Main Content */
    .home-main {
      flex: 1;
      padding: 1.5rem 1.25rem;
      padding-bottom: 100px;
      overflow-y: auto;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .results-count {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    /* Plans List */
    .plans-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .plan-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-color);
    }

    .plan-card-wrapper {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .plan-icon {
      flex-shrink: 0;
      display: flex;
      align-items: flex-start;
    }

    .plan-icon img {
      width: 56px;
      height: 70px;
      border-radius: 8px;
      object-fit: contain;
      background: #fff;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    }

    .plan-icon span {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 70px;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
      font-weight: 700;
      font-size: 1rem;
      color: var(--primary-color);
    }

    .plan-content-wrapper {
      flex: 1;
    }

    .plan-header {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .plan-info {
      flex: 1;
    }

    .plan-name {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      line-height: 1.3;
    }

    .plan-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0;
    }

    .plan-content-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .plan-price-section {
      flex: 1;
    }

    .plan-price {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .plan-price-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .plan-coverage {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--primary-color);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
      line-height: 1.3;
    }

    .plan-coverage-label {
      font-size: 0.75rem;
      margin-bottom: 0.25rem;
    }

    .plan-coverage-value {
      font-size: 0.875rem;
      font-weight: 600;
    }

    .plan-features {
      list-style: none;
      padding: 0;
      margin: 0 0 1rem 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .plan-features li {
      font-size: 0.875rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
    }

    .plan-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .plan-btn {
      flex: 1;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.75rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .plan-btn:hover {
      background: #FF4A50;
    }

    .plan-btn-compare {
      flex: 1;
      background: white;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      padding: 0.75rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .plan-btn-compare:hover {
      background: var(--primary-color);
      color: white;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
    }

    .empty-state i {
      width: 64px;
      height: 64px;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 428px;
      background: white;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0.75rem 0.5rem;
      z-index: 100;
      gap: 0;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      color: var(--text-secondary);
      transition: color 0.2s;
      text-decoration: none;
      flex: 1 1 0;
      min-width: 0;
      text-align: center;
    }

    .nav-item.active {
      color: var(--primary-color);
    }

    .nav-item.help-special {
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      min-width: 56px;
      max-width: 56px;
      padding: 0;
      margin-top: -0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      flex: 1 1 0;
      position: relative;
    }

    .nav-item.help-special .nav-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      color: white;
      margin: 0;
      line-height: 1;
    }

    .nav-item.help-special .ai-badge {
      position: absolute;
      top: -12px;
      right: -20px;
      background: white;
      border-radius: 12px;
      padding: 0.25rem 0.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.6rem;
      font-weight: 600;
      color: var(--primary-color);
      white-space: nowrap;
      z-index: 10;
    }

    .nav-item.help-special .ai-badge i {
      width: 12px;
      height: 12px;
      color: var(--primary-color);
    }

    .nav-item.help-special .ai-badge::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 20px;
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 4px solid white;
    }

    .nav-item.help-special i {
      display: none;
    }

    .nav-label {
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* Plan Detail Modal */
    .plan-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 428px;
      height: 100vh;
      background: white;
      z-index: 1000;
      overflow-y: auto;
    }

    .plan-detail-modal.active {
      display: block;
    }

    /* Data Sharing Terms modal */
    .terms-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1100;
    }

    .terms-modal.active {
      display: flex;
    }

    .terms-modal-content {
      width: calc(100% - 2rem);
      max-width: 400px;
      max-height: 70vh;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    @media (max-width: 480px) {
      .terms-modal-content {
        max-width: 360px;
        margin: 0 1rem;
      }
    }

    @media (max-height: 700px) {
      .terms-modal-content {
        max-height: 65vh;
      }
      .terms-modal-header {
        padding: 0.85rem 1rem 0.5rem;
      }
      .terms-modal-body {
        padding: 0.75rem 1rem;
        font-size: 0.8rem;
      }
      .terms-modal-footer {
        padding: 0.6rem 1rem 0.9rem;
      }
    }

    .terms-modal-header {
      padding: 1.25rem 1.25rem 0.75rem;
      border-bottom: 1px solid #f2f2f7;
    }

    .terms-modal-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .terms-modal-body {
      padding: 1rem 1.25rem;
      overflow-y: auto;
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text-primary);
      background: #fafafa;
    }

    .terms-modal-body p {
      margin-bottom: 0.75rem;
    }

    .terms-modal-footer {
      padding: 0.75rem 1.25rem 1.25rem;
      display: flex;
      gap: 0.75rem;
      border-top: 1px solid #f2f2f7;
      background: #fff;
    }

    .terms-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 999px;
      border: 1px solid #e5e5ea;
      background: #f5f5f7;
      color: var(--text-primary);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
    }

    .terms-btn.primary {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: #fff;
    }

    .terms-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .terms-btn.primary:disabled {
      background: #ccc;
      border-color: #ccc;
      color: #999;
    }

    .plan-detail-header {
      background: white;
      padding: 1rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .plan-detail-header h3 {
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
    }

    .close-modal-btn {
      background: var(--bg-secondary);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-primary);
    }

    .plan-detail-content {
      padding: 1.5rem 1.25rem;
    }

    .plan-company-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .company-logo {
      width: 40px;
      height: 40px;
      background: #34C759;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 0.75rem;
      overflow: hidden;
    }

    .company-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #fff;
      padding: 2px;
    }

    .company-name {
      font-size: 0.875rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .action-buttons-top {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .action-btn-top {
      flex: 1;
      min-width: calc(33.333% - 0.35rem);
      max-width: calc(50% - 0.25rem);
      padding: 0.625rem 0.75rem;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      background: white;
      color: var(--primary-color);
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      transform: scale(1) !important;
      box-sizing: border-box;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .action-btn-top span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 1;
      min-width: 0;
    }

    .action-btn-top i {
      flex-shrink: 0;
    }

    .action-btn-top:hover {
      background: var(--primary-color);
      color: white;
      transform: scale(1) !important;
    }

    .action-btn-top:active {
      transform: scale(1) !important;
    }

    .action-btn-top:focus {
      transform: scale(1) !important;
      outline: none;
    }

    .action-btn-top.primary {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .action-btn-top.primary:hover {
      background: #FF4A50;
    }

    .plan-select-section {
      margin-bottom: 1.5rem;
    }

    .plan-select-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      display: block;
    }

    .plan-select-dropdown {
      width: 100%;
      padding: 0.875rem;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      background: white;
      color: var(--text-primary);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23EA580C' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.875rem center;
      background-size: 12px;
      padding-right: 2.5rem;
    }

    .pricing-section {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .pricing-info {
      flex: 1;
    }

    .pricing-row {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
    }

    .pricing-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .pricing-amount {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pricing-period {
      font-size: 0.875rem;
      color: var(--primary-color);
    }

    .daily-price {
      background: rgba(234, 88, 12, 0.15);
      padding: 0.5rem 0.75rem;
      border-radius: 20px;
      display: inline-block;
      margin-top: 0.5rem;
    }

    .daily-price-text {
      font-size: 0.875rem;
      color: var(--primary-color);
      font-weight: 500;
    }

    .features-section {
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .features-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .feature-pill {
      background: var(--primary-color);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      border: none;
      white-space: nowrap;
    }

    .show-more-link {
      color: var(--text-primary);
      font-size: 0.875rem;
      font-weight: 500;
      text-decoration: none;
      display: inline-block;
      margin-top: 0.5rem;
    }

    .annual-limit-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 1rem;
    }

    .annual-limit-label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .annual-limit-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Product Disclosure Sheet Dropdown */
    .pdf-dropdown {
      display: none;
      margin-top: 1rem;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      animation: slideDown 0.3s ease-out;
    }

    .pdf-dropdown.active {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pdf-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .pdf-item {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.625rem 0.875rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: inherit;
    }

    .pdf-item:hover {
      border-color: var(--primary-color);
      box-shadow: var(--shadow);
    }

    .pdf-info {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      flex: 1;
      min-width: 0;
    }

    .pdf-icon {
      width: 32px;
      height: 32px;
      background: rgba(234, 88, 12, 0.1);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      flex-shrink: 0;
    }

    .pdf-details {
      flex: 1;
      min-width: 0;
    }

    .pdf-name {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pdf-size {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .pdf-arrow {
      width: 18px;
      height: 18px;
      height: 24px;
      color: var(--text-secondary);
      flex-shrink: 0;
    }
  </style>
  </head>
  <body>
    <div class="app">
      <!-- Header -->
      <header class="home-header">
        <div class="header-top">
          <div class="user-greeting">
            <div class="brand-name"> InsureMart</div>
            <h2>Medical Plans</h2>
          </div>
          <div class="header-actions">
            <button class="compare-btn" onclick="openComparePlans()"
              title="Compare Plans">
              <i data-lucide="git-compare"></i>
              <span class="compare-badge" id="compare-badge"
                style="display: none;">0</span>
            </button>
            <button class="back-btn"
              onclick="window.location.href='medical-plan-filter.html'">
              <i data-lucide="arrow-left"></i>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="home-main">
        <h3 class="section-title">Available Plans</h3>
        <div class="results-count" id="results-count"></div>

        <div id="plans-list" class="plans-list">
          <!-- Plans will be rendered here -->
        </div>
      </main>

      <!-- Plan Detail Modal -->
      <div class="plan-detail-modal" id="plan-detail-modal">
        <div class="plan-detail-header">
          <h3>Plan Details</h3>
          <button class="close-modal-btn" onclick="closePlanDetails()">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div class="plan-detail-content" id="plan-detail-content">
          <!-- Plan details will be rendered here -->
        </div>
      </div>

      <!-- Data Sharing Terms Modal -->
      <div class="terms-modal" id="terms-modal">
        <div class="terms-modal-content">
          <div class="terms-modal-header">
            <h3 class="terms-modal-title">Data Sharing Terms &amp;
              Conditions</h3>
          </div>
          <div class="terms-modal-body">
            <p><strong>By agreeing to these terms, you expressly acknowledge and
                agree to the following:</strong></p>
            <p>
              You hereby expressly authorize <strong></strong> to share your
              Personal Data with the Insurance Provider
              and Insurance Agency (hereinafter referred to as "Partner"). You
              further consent to the Partner's Privacy Policy
              and acknowledge that your Personal Data will be used, processed,
              and handled in accordance with the Partner's
              Privacy Policy.
            </p>
            <p>
              You acknowledge that once your Personal Data is shared with the
              Partner, the Partner will have sole and full
              control over the copy of your Personal Data, and you will be
              required to contact the Partner directly for any
              matters related to your Personal Data.
            </p>
            <p>
              You expressly consent to the transfer of your Personal Data to a
              location outside Malaysia, subject to the terms
              outlined in the Partner's Privacy Policy.
            </p>
            <p>
              <strong></strong> shall be released from all obligations and
              responsibilities related to the copy of
              Personal Data shared with the Partner. For clarity,
              <strong></strong> will ensure that any Personal Data
              retained under its control is processed in accordance with
              <strong></strong>'s Privacy Policy and
              applicable laws.
            </p>
            <p>
              You may withdraw your consent for further disclosure of your
              Personal Data at any time by submitting a request to
              <a href="mailto:support@mdeal.com.my"></a>. However, such
              withdrawal may result in the Partner
              or <strong></strong> declining, refusing, or making services
              inaccessible to you. Please note that any
              withdrawal of consent will not affect Personal Data previously
              shared, for which you must contact the Partner
              directly.
            </p>
          </div>
          <div class="terms-modal-footer">
            <button type="button" class="terms-btn"
              onclick="closeTermsModal()">Close</button>
            <button type="button" id="accept-terms-btn"
              class="terms-btn primary" onclick="acceptTermsAndProceed()"
              disabled>I accept</button>
          </div>
        </div>
      </div>

      <!-- Bottom Navigation -->
      <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
          <i data-lucide="search" style="width: 24px; height: 24px;"></i>
          <span class="nav-label">Explore</span>
        </a>
        <a href="policy.html" class="nav-item">
          <i data-lucide="file-text" style="width: 24px; height: 24px;"></i>
          <span class="nav-label">My Policies</span>
        </a>
        <a href="help.html" class="nav-item help-special">
          <span class="nav-label">Help</span>
          <span class="ai-badge">
            <span>AI Consultant</span>
          </span>
        </a>
        <a href="deals.html" class="nav-item">
          <i data-lucide="tag" style="width: 24px; height: 24px;"></i>
          <span class="nav-label">Deals</span>
        </a>
        <a href="profile.html" class="nav-item">
          <i data-lucide="more-vertical" style="width: 24px; height: 24px;"></i>
          <span class="nav-label">More</span>
        </a>
      </nav>
    </div>

    <script>
    lucide.createIcons();

    // Sample medical insurance plans data (same as filter page)
    const medicalPlans = [
      {
        name: 'Zurich ZMedProtect',
        coverage: 1000000,
        list:  ['Zurich ZMedProtect Plan 1', 'Zurich ZMedProtect Plan 2', 'Zurich ZMedProtect Plan 3'],
        price: 350,
        features: ['Ambulance Fee', 'Anaesthetist Fees', 'Daily Cash Allowance at Gov Hospital', 'Maternity Benefits', 'Daily Cash Allowance', 'Day Surgery'],
        type: 'normal',
        minAge: 0,
        maxAge: 80,
        gender: 'both',
        productDisclosureSheet: 'https://edge.sitecorecloud.io/zurichinsurf8c0-zwpshared-prod-d824/media/project/zurich-headless/malaysia/docs/insurance-products/product-disclosure-sheets/zgimb-z-medprotect-pds.pdf',
        brochure: 'https://edge.sitecorecloud.io/zurichinsurf8c0-zwpshared-prod-d824/media/project/zurich-headless/malaysia/docs/insurance-products/brochures/zgimb-z-medprotect-brochure.pdf',
        policyWording: 'https://edge.sitecorecloud.io/zurichinsurf8c0-zwpshared-prod-d824/media/project/zurich-headless/malaysia/docs/insurance-products/policy-wordings/zgimb-z-medprotect-policy-wordings.pdf',
        logo: 'zurich-logo.svg',
      },
      {
       name: 'Allianz Medicure', 
       coverage: 500000,
       list: ['Allianz Medicure Plan 1', 'Allianz Medicure Plan 2', 'Allianz Medicure Plan 3'],
       price: 949,
       features: ['Ambulance Fee', 'Anaesthetist Fees', 'Daily Cash Allowance at Gov Hospital', 'Maternity Benefits', 'Daily Cash Allowance', 'Day Surgery'],
       type: 'normal',
       minAge: 0,
       maxAge: 80,
       gender: 'both',
       productDisclosureSheet: 'https://www.allianz.com.my/content/dam/onemarketing/azmb/wwwallianzcommy/product-document/AMC_PDS_ENG.pdf',
       brochure: 'https://mdeal-public-bucket.s3.https://www.allianz.com.my/content/dam/onemarketing/azmb/wwwallianzcommy/product-document/AMC_Brochure_ENG.pdf',
       policyWording: 'https://www.allianz.com.my/content/dam/onemarketing/azmb/wwwallianzcommy/product-document/AMC_PW_ENG.pdf',
       logo: 'Allianz.svg',
      },
      {
        name: 'SmartCare Optimum Plus Plan 1',
        coverage: 2100000,
        list: ['SmartCare Optimum Plus Plan 1', 'SmartCare Optimum Plus Plan 2', 'SmartCare Optimum Plus Plan 3'],
        price: 1441,
        features: ['Ambulance Fee', 'Anaesthetist Fees', 'Daily Cash Allowance at Gov Hospital', 'Maternity Benefits', 'Daily Cash Allowance', 'Day Surgery'],
        type: 'normal',
        minAge: 0,
        maxAge: 80,
        gender: 'both',
        productDisclosureSheet: 'https://www.generali.com.my/wf-assets/smartcare-optimum-plus-pds',
        brochure: 'https://www.generali.com.my/wf-assets/smartcare-optimum-plus-brochure-em',
        policyWording: 'https://www.generali.com.my/wf-assets/smartcare-optimum-plus-pw',
        logo: 'Assicurazioni_Generali_logo.png',
      },
    ];

    // Get filter parameters from URL or sessionStorage
    function getFilters() {
      const urlParams = new URLSearchParams(window.location.search);
      const filters = {
        gender: urlParams.get('gender') || sessionStorage.getItem('filter_gender') || '',
        dob: urlParams.get('dob') || sessionStorage.getItem('filter_dob') || '',
        'annual-limit': urlParams.get('annual-limit') || sessionStorage.getItem('filter_annual-limit') || '',
        'plan-type': urlParams.get('plan-type') || sessionStorage.getItem('filter_plan-type') || ''
      };
      return filters;
    }

    // Calculate age from date of birth
    function calculateAge(dob) {
      if (!dob) return null;
      const today = new Date();
      const birthDate = new Date(dob);
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    }

    // Filter plans based on criteria
    function filterPlans(filters) {
      const filtered = medicalPlans.filter(plan => {
        // Filter by gender (if specified)
        if (filters.gender && plan.gender !== 'both' && plan.gender !== filters.gender) {
          return false;
        }

        // Filter by age (from date of birth)
        if (filters.dob) {
          const age = calculateAge(filters.dob);
          if (age !== null && (age < plan.minAge || age > plan.maxAge)) {
            return false;
          }
        }

        // Filter by annual limit range
        if (filters['annual-limit']) {
          const coverage = typeof plan.coverage === 'number' ? plan.coverage : parseInt(plan.coverage.replace(/[RM,\s]/g, ''));
          const range = filters['annual-limit'];
          
          if (range === '0-500k' && coverage > 500000) return false;
          if (range === '500k-1m' && (coverage < 500000 || coverage > 1000000)) return false;
          if (range === '1m-2m' && (coverage < 1000000 || coverage > 2000000)) return false;
          if (range === '2m-5m' && (coverage < 2000000 || coverage > 5000000)) return false;
          if (range === '5m+' && coverage < 5000000) return false;
        }

        // Filter by plan type (takaful or normal)
        if (filters['plan-type'] && plan.type !== filters['plan-type']) {
          return false;
        }

        return true;
      });

      return filtered;
    }

    // Render filtered plans
    function renderPlans(plans) {
      // Sort plans by annual limit (coverage) in ascending order
      const sortedPlans = [...plans].sort((a, b) => {
        const coverageA = typeof a.coverage === 'number' ? a.coverage : parseInt(a.coverage.replace(/[RM,\s]/g, ''));
        const coverageB = typeof b.coverage === 'number' ? b.coverage : parseInt(b.coverage.replace(/[RM,\s]/g, ''));
        return coverageA - coverageB;
      });
      
      const plansList = document.getElementById('plans-list');
      const resultsCount = document.getElementById('results-count');

      if (sortedPlans.length === 0) {
        plansList.innerHTML = `
          <div class="empty-state">
            <i data-lucide="search-x" style="color: var(--text-secondary);"></i>
            <p>No plans found matching your criteria.</p>
            <p style="margin-top: 0.5rem; font-size: 0.875rem;">Please adjust your filters and try again.</p>
          </div>
        `;
        resultsCount.textContent = '0 plans found';
      } else {
        resultsCount.textContent = `${sortedPlans.length} plan${sortedPlans.length > 1 ? 's' : ''} found`;
        
        plansList.innerHTML = sortedPlans.map((plan, index) => `
          <div class="plan-card">
            <div class="plan-card-wrapper">
              <div class="plan-icon">
                ${plan.logo ? `
                  <img src="insurance-img/${plan.logo}" alt="${plan.name} logo"
                    onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${plan.name.substring(0, 2).toUpperCase()}</span>';">
                ` : `
                  <span>${plan.name.substring(0, 2).toUpperCase()}</span>
                `}
              </div>
              <div class="plan-content-wrapper">
                <div class="plan-header">
                  <div class="plan-info">
                    <h4 class="plan-name">${plan.name}</h4>
                  </div>
                </div>
                <div class="plan-content-row">
                  <div class="plan-price-section">
                    <div class="plan-price">RM ${plan.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                    <div class="plan-price-label">per annum</div>
                  </div>
                  <div class="plan-coverage">
                    <div class="plan-coverage-label">Annual Limit:</div>
                    <div class="plan-coverage-value">RM ${plan.coverage.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="plan-buttons">
              <button class="plan-btn" onclick="viewPlanDetails(${index})">View Details</button>
              <button class="plan-btn-compare" onclick="addToCompare(${index})">Add to Compare</button>
            </div>
          </div>
        `).join('');
        
        lucide.createIcons();
        window.filteredPlans = sortedPlans; // Store for detail view
      }
    }

    // Show plan details modal
    function viewPlanDetails(planIndex) {
      const plan = window.filteredPlans[planIndex];
      if (!plan) return;

      // Calculate daily price
      const annualPrice = plan.price || 189;
      const dailyPrice = (annualPrice / 365).toFixed(2);

      const detailContent = document.getElementById('plan-detail-content');
      detailContent.setAttribute('data-plan-index', planIndex);
      detailContent.innerHTML = `
        <div class="plan-company-info">
          <div class="company-logo">
            ${plan.logo ? `
              <img src="insurance-img/${plan.logo}" alt="${plan.name} logo"
                onerror="this.style.display='none'; this.parentElement.innerHTML='<span style\\='font-weight: 700; font-size: 0.85rem;\\'>${plan.name.substring(0, 2).toUpperCase()}</span>';">
            ` : `
              <span style="font-weight: 700; font-size: 0.85rem;">
                ${plan.name.substring(0, 2).toUpperCase()}
              </span>
            `}
          </div>
          <div class="company-name">${plan.name}</div>
        </div>

        <div class="action-buttons-top">
          <button class="action-btn-top" onclick="viewProductSheet()">
            <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
            <span>Product Disclosure Sheet</span>
          </button>
          <button class="action-btn-top primary" onclick="purchasePlan(${planIndex})">
            <i data-lucide="shopping-cart" style="width: 16px; height: 16px;"></i>
            <span>Purchase</span>
          </button>
        </div>

        <div class="plan-select-section">
          <label class="plan-select-label">Select Your Policy Plan:</label>
          <select class="plan-select-dropdown" id="plan-variant">
            ${plan.list ? plan.list.map(item => `
              <option value="${item}" ${item === plan.list[0] ? 'selected' : ''}>${item}</option>
            `).join('') : `
              <option value="${plan.name}" selected>${plan.name}</option>
            `}
          </select>
        </div>

        <div class="pricing-section">
          <div class="pricing-info">
            <div class="pricing-row">
              <span class="pricing-label">From</span>
              <div class="pricing-amount">
                <i data-lucide="info" style="width: 18px; height: 18px; color: var(--text-secondary);"></i>
                RM ${annualPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
              </div>
              <span class="pricing-period">per annum</span>
            </div>
            <div class="daily-price">
              <div class="daily-price-text">RM ${parseFloat(dailyPrice).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} per day</div>
            </div>
          </div>
        </div>

        <div class="features-section">
          <div class="features-pills" id="features-pills-${planIndex}">
            ${plan.features.slice(0, 4).map(feature => `
              <button class="feature-pill">${feature}</button>
            `).join('')}
            <div id="more-features-${planIndex}" style="display: none;">
              ${plan.features.slice(4).map(feature => `
                <button class="feature-pill">${feature}</button>
              `).join('')}
            </div>
          </div>
          ${plan.features.length > 4 ? `
            <a href="#" class="show-more-link" id="show-more-${planIndex}" onclick="showMoreFeatures(${planIndex}); return false;">Show More</a>
            <a href="#" class="show-more-link" id="show-less-${planIndex}" onclick="showLessFeatures(${planIndex}); return false;" style="display: none;">Show Less</a>
          ` : ''}
        </div>

        <div class="annual-limit-section">
          <div class="annual-limit-label">
            Annual Limit:
          </div>
          <div class="annual-limit-value">
            <i data-lucide="info" style="width: 18px; height: 18px; color: var(--text-secondary);"></i>
            RM ${plan.coverage.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
          </div>
        </div>
      `;

      lucide.createIcons();
      document.getElementById('plan-detail-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close plan details modal
    function closePlanDetails() {
      document.getElementById('plan-detail-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    // Action handlers
    function viewProductSheet() {
      const planDetailContent = document.getElementById('plan-detail-content');
      if (!planDetailContent) return;
      
      // Get the plan index from data attribute
      const planIndex = planDetailContent.getAttribute('data-plan-index');
      const plan = planIndex !== null ? window.filteredPlans[planIndex] : null;
      
      // Check if dropdown already exists
      let dropdown = planDetailContent.querySelector('.pdf-dropdown');
      
      if (dropdown) {
        // Toggle existing dropdown
        dropdown.classList.toggle('active');
      } else {
        // Create new dropdown
        const actionButtons = planDetailContent.querySelector('.action-buttons-top');
        if (!actionButtons) return;
        
        // PDF files list - use plan data if available, otherwise use defaults
        const pdfFiles = [
          { name: 'Product Disclosure Sheet',  url: plan?.productDisclosureSheet || '#' },
          { name: 'Brochure', url: plan?.brochure || '#' },
          { name: 'Certificate Wording', url: plan?.policyWording || '#' },
        ];

        const dropdownHTML = `
          <div class="pdf-dropdown active" id="pdf-dropdown">
            <div class="pdf-list" style="padding: 0.75rem;">
              ${pdfFiles.map((pdf, index) => `
                <a href="${pdf.url}" class="pdf-item" target="_blank" onclick="event.preventDefault(); openPDF('${pdf.url}', '${pdf.name}')">
                  <div class="pdf-info">
                    <div class="pdf-icon">
                      <i data-lucide="file-text" style="width: 18px; height: 18px;"></i>
                    </div>
                    <div class="pdf-details">
                      <div class="pdf-name">${pdf.name}</div>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="pdf-arrow"></i>
                </a>
              `).join('')}
            </div>
          </div>
        `;
        
        actionButtons.insertAdjacentHTML('afterend', dropdownHTML);
        lucide.createIcons();
      }
    }

    function openPDF(url, filename) {
      // Open PDF in new tab or download
      if (url !== '#') {
        window.open(url, '_blank');
      }
    }

    function addToCompare(planIndex) {
      const plan = window.filteredPlans[planIndex];
      let compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
      
      // Get the selected variant name if plan has variants
      let planNameToStore = plan.name;
      if (plan.list) {
        const variantSelect = document.getElementById('plan-variant');
        if (variantSelect) {
          planNameToStore = variantSelect.value;
        }
      }
      
      // Check if plan already in compare list (check by the stored name)
      const exists = compareList.findIndex(p => p.name === planNameToStore);
      if (exists >= 0) {
        compareList.splice(exists, 1);
        alert('Plan removed from compare list');
      } else {
        // Check if maximum of 3 plans already reached
        if (compareList.length >= 3) {
          alert('Maximum of 3 plans can be compared. Please remove a plan first.');
          return;
        }
        compareList.push({ name: planNameToStore, index: planIndex });
        alert('Plan added to compare list');
      }
      
      sessionStorage.setItem('comparePlans', JSON.stringify(compareList));
      updateCompareBadge();
    }

    // Update compare badge count
    function updateCompareBadge() {
      const compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
      const badge = document.getElementById('compare-badge');
      if (badge) {
        if (compareList.length > 0) {
          badge.textContent = compareList.length;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      }
    }

    // Compare plans function
    function openComparePlans() {
      // Get selected plans from sessionStorage or show comparison modal
      const compareList = JSON.parse(sessionStorage.getItem('comparePlans') || '[]');
      window.location.href = 'compare-plans.html';
    }

    let pendingPurchasePlanIndex = null;

    function purchasePlan(planIndex) {
      // Store plan index and show Data Sharing Terms modal
      pendingPurchasePlanIndex = planIndex;
      const modal = document.getElementById('terms-modal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Disable accept button initially
        const acceptBtn = document.getElementById('accept-terms-btn');
        if (acceptBtn) {
          acceptBtn.disabled = true;
        }
        
        // Set up scroll detection
        const modalBody = modal.querySelector('.terms-modal-body');
        if (modalBody) {
          // Reset scroll position
          modalBody.scrollTop = 0;
          
          // Check scroll position function
          const checkScrollPosition = () => {
            const scrollTop = modalBody.scrollTop;
            const scrollHeight = modalBody.scrollHeight;
            const clientHeight = modalBody.clientHeight;
            
            // Check if scrolled to bottom (with 10px tolerance)
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
            
            if (acceptBtn) {
              acceptBtn.disabled = !isAtBottom;
            }
          };
          
          // Add scroll event listener
          modalBody.addEventListener('scroll', checkScrollPosition);
          
          // Check initial state (in case content is short and already fully visible)
          setTimeout(checkScrollPosition, 100);
        }
      }
    }

    function closeTermsModal() {
      const modal = document.getElementById('terms-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
        // Reset scroll position and button state
        const modalBody = modal.querySelector('.terms-modal-body');
        const acceptBtn = document.getElementById('accept-terms-btn');
        if (modalBody) {
          modalBody.scrollTop = 0;
          // Remove scroll event listener by cloning and replacing
          const newBody = modalBody.cloneNode(true);
          modalBody.parentNode.replaceChild(newBody, modalBody);
        }
        if (acceptBtn) {
          acceptBtn.disabled = true;
        }
      }
      pendingPurchasePlanIndex = null;
    }

    function acceptTermsAndProceed() {
      // Store selected plan information
      if (pendingPurchasePlanIndex !== null) {
        const plan = window.filteredPlans[pendingPurchasePlanIndex];
        if (plan) {
          // Get the selected variant name if plan has variants
          let planNameToStore = plan.name;
          if (plan.list) {
            const variantSelect = document.getElementById('plan-variant');
            if (variantSelect) {
              planNameToStore = variantSelect.value;
            }
          }
          // Store plan name in sessionStorage for purchase pages
          sessionStorage.setItem('selectedPlanName', planNameToStore);
        }
      }
      
      // Continue to purchase flow
      closeTermsModal();
      window.location.href = 'purchase-step-1.html';
    }

    function showMoreFeatures(planIndex) {
      const moreFeatures = document.getElementById(`more-features-${planIndex}`);
      const showMoreLink = document.getElementById(`show-more-${planIndex}`);
      const showLessLink = document.getElementById(`show-less-${planIndex}`);
      
      if (moreFeatures && showMoreLink && showLessLink) {
        moreFeatures.style.display = 'flex';
        moreFeatures.style.flexWrap = 'wrap';
        moreFeatures.style.gap = '0.5rem';
        showMoreLink.style.display = 'none';
        showLessLink.style.display = 'inline-block';
      }
    }

    function showLessFeatures(planIndex) {
      const moreFeatures = document.getElementById(`more-features-${planIndex}`);
      const showMoreLink = document.getElementById(`show-more-${planIndex}`);
      const showLessLink = document.getElementById(`show-less-${planIndex}`);
      
      if (moreFeatures && showMoreLink && showLessLink) {
        moreFeatures.style.display = 'none';
        showMoreLink.style.display = 'inline-block';
        showLessLink.style.display = 'none';
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      const filters = getFilters();
      const filteredPlans = filterPlans(filters);
      renderPlans(filteredPlans);
      updateCompareBadge();
      
      // Add event listener for compare button
      const compareBtn = document.querySelector('.compare-btn');
      if (compareBtn) {
        compareBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          openComparePlans();
        });
      }
    });
  </script>
  </body>
</html>
